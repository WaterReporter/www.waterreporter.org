<div data-ng-include="'/modules/shared/views/header--view.html'"></div>

<main class="site--content">
  <leaflet class="map" markers="page.map.markers" defaults="page.map.defaults" layers="page.map.layers" center="page.map.center" bounds="page.map.bounds"></leaflet>

  <div class="container">
    <div class="row">

      <div class="col-sm-4">
        <div id="user--profile--{{ page.data.id }}">
          <p class="text-center">
            <img class="user--profile--image img-circle" data-ng-if="page.data.properties.email" gravatar-src="'{{ page.data.properties.email }}'" gravatar-size="256" /><br /><br />
            <strong>{{ page.data.properties.first_name }} {{ page.data.properties.last_name }}</strong><br />
            {{ page.data.properties.title }} <span data-ng-if="page.data.properties.title && page.data.properties.organization_name">at</span><br data-ng-if="page.data.properties.title && page.data.properties.organization_name" />
            {{ page.data.properties.organization_name }}
          </p>
          <p class="text-center">
            <a data-ng-if="!page.visible.reports && $root.isCurrentUser" data-ng-click="page.visible.reports = true; page.visible.closures = false; page.visible.submissions = false;">
              {{ page.reports.properties.num_results | number:0 }} Reports
            </a>
            <span data-ng-if="page.visible.reports && $root.isCurrentUser">
              {{ page.reports.properties.num_results | number:0 }} Reports
            </span><br data-ng-if="$root.isCurrentUser" />
            <a data-ng-if="!page.visible.submissions" data-ng-click="page.visible.submissions = true; page.visible.closures = false; page.visible.reports = false;">
              {{ page.submissions.properties.num_results | number:0 }} Submissions
            </a>
            <span data-ng-if="page.visible.submissions">
              {{ page.submissions.properties.num_results | number:0 }} Submissions
            </span><br />
            <a data-ng-if="!page.visible.closures" data-ng-click="page.visible.closures = true; page.visible.reports = false; page.visible.submissions = false;">
              {{ page.closures.properties.num_results | number:0 }} Actions
            </a>
            <span data-ng-if="page.visible.closures">
              {{ page.closures.properties.num_results | number:0 }} Actions
            </span>
          </p>
          <p>
            {{ page.data.properties.description }}
          </p>
        </div>
      </div>

      <div class="col-sm-8">
        <div data-ng-show="page.visible.reports && !page.visible.submissions && !page.visible.closures" class="row"
             data-ng-if="page.reports.features.length"
             data-ng-repeat="report in page.reports.features">
          <div id="report--{{ report.properties.id }}" class="panel panel-default" data-ng-class="{'report--state--open': (report.properties.state === 'open'), 'report--state--closed': (report.properties.state === 'closed') }">
            <div class="panel-heading">
              <p class="pull-right">{{ report.properties.report_date | date:"MMM d, yyyy"}}</p>
              <a href="/profiles/{{ report.properties.owner.id }}">
                <img class="pull-left img-circle" data-ng-if="report.properties.owner.properties.email" gravatar-src="'{{ report.properties.owner.properties.email }}'" gravatar-size="64" style="padding-right: 12px;" />
              </a>
              <p>
                <a href="/profiles/{{ report.properties.owner.id }}">
                  {{ report.properties.owner.properties.first_name }} {{ report.properties.owner.properties.last_name }}
                </a><br />
                {{ report.properties.owner.properties.title }} <span data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name">at</span><br data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name" />
                {{ report.properties.owner.properties.organization_name }}
              </p>
            </div>
            <div class="panel-body">

              <figure data-ng-if="report.properties.images && report.properties.images.length">
      <!--           <img photoio photoio-u="image.properties.original" photoio-w="640" photoio-h="640" photoio-mode="crop" data-ng-repeat="image in report.properties.images" /> -->
                <a href="/reports/{{ report.id }}">
                  <img class="img-responsive" data-ng-src="{{ image.properties.original }}" width="640" data-ng-repeat="image in report.properties.images" />
                </a>
              </figure>

              <p>{{ report.properties.report_description }}</p>

              <ul data-ng-if="report.properties.tags.length">
                <li data-ng-repeat="tag in report.properties.tags">
                  <a href="" data-ng-click="activity.search.hashtag(tag.properties.tag, 'report_description')">
                    #{{ tag.properties.tag }}
                  </a>
                </li>
              </ul>

              <p>
                {{ report.geometry.geometries[0].coordinates[0] }}<br />
                {{ report.geometry.geometries[0].coordinates[1] }}
              </p>
            </div>
          </div>
        </div>

                    <!-- Truthy Result Set (1+) -->
        <div data-ng-show="page.visible.submissions && !page.visible.reports && !page.visible.closures" class="row"
             data-ng-if="page.submissions.features.length"
             data-ng-repeat="report in page.submissions.features">
          <div id="report--{{ report.properties.id }}" class="panel panel-default" data-ng-class="{'report--state--open': (report.properties.state === 'open'), 'report--state--closed': (report.properties.state === 'closed') }">
            <div class="panel-heading">
              <p class="pull-right">{{ report.properties.report_date | date:"MMM d, yyyy"}}</p>
              <a href="/profiles/{{ report.properties.owner.id }}">
                <img class="pull-left img-circle" data-ng-if="report.properties.owner.properties.email" gravatar-src="'{{ report.properties.owner.properties.email }}'" gravatar-size="64" style="padding-right: 12px;" />
              </a>
              <p>
                <a href="/profiles/{{ report.properties.owner.id }}">
                  {{ report.properties.owner.properties.first_name }} {{ report.properties.owner.properties.last_name }}
                </a><br />
                {{ report.properties.owner.properties.title }} <span data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name">at</span><br data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name" />
                {{ report.properties.owner.properties.organization_name }}
              </p>
            </div>
            <div class="panel-body">

              <figure data-ng-if="report.properties.images && report.properties.images.length">
      <!--           <img photoio photoio-u="image.properties.original" photoio-w="640" photoio-h="640" photoio-mode="crop" data-ng-repeat="image in report.properties.images" /> -->
                <a href="/reports/{{ report.id }}">
                  <img class="img-responsive" data-ng-src="{{ image.properties.original }}" width="640" data-ng-repeat="image in report.properties.images" />
                </a>
              </figure>

              <p>{{ report.properties.report_description }}</p>

              <ul data-ng-if="report.properties.tags.length">
                <li data-ng-repeat="tag in report.properties.tags">
                  <a href="" data-ng-click="activity.search.hashtag(tag.properties.tag, 'report_description')">
                    #{{ tag.properties.tag }}
                  </a>
                </li>
              </ul>

              <p>
                {{ report.geometry.geometries[0].coordinates[0] }}<br />
                {{ report.geometry.geometries[0].coordinates[1] }}
              </p>
            </div>
          </div>
        </div>

        <div data-ng-show="!page.visible.reports && page.visible.closures" class="row"
             data-ng-if="page.closures.features.length"
             data-ng-repeat="report in page.closures.features">
          <div id="report--{{ report.properties.id }}" class="panel panel-default" data-ng-class="{'report--state--open': (report.properties.state === 'open'), 'report--state--closed': (report.properties.state === 'closed') }">
            <div class="panel-heading">
              <p class="pull-right">{{ report.properties.report_date | date:"MMM d, yyyy"}}</p>
              <a href="/profiles/{{ report.properties.owner.id }}">
                <img class="pull-left img-circle" data-ng-if="report.properties.owner.properties.email" gravatar-src="'{{ report.properties.owner.properties.email }}'" gravatar-size="64" style="padding-right: 12px;" />
              </a>
              <p>
                <a href="/profiles/{{ report.properties.owner.id }}">
                  {{ report.properties.owner.properties.first_name }} {{ report.properties.owner.properties.last_name }}
                </a><br />
                {{ report.properties.owner.properties.title }} <span data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name">at</span><br data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name" />
                {{ report.properties.owner.properties.organization_name }}
              </p>
            </div>
            <div class="panel-body">

              <figure data-ng-if="report.properties.images && report.properties.images.length">
      <!--           <img photoio photoio-u="image.properties.original" photoio-w="640" photoio-h="640" photoio-mode="crop" data-ng-repeat="image in report.properties.images" /> -->
                <a href="/reports/{{ report.id }}">
                  <img class="img-responsive" data-ng-src="{{ image.properties.original }}" width="640" data-ng-repeat="image in report.properties.images" />
                </a>
              </figure>

              <p>{{ report.properties.report_description }}</p>

              <ul data-ng-if="report.properties.tags.length">
                <li data-ng-repeat="tag in report.properties.tags">
                  <a href="" data-ng-click="activity.search.hashtag(tag.properties.tag, 'report_description')">
                    #{{ tag.properties.tag }}
                  </a>
                </li>
              </ul>

              <p>
                {{ report.geometry.geometries[0].coordinates[0] }}<br />
                {{ report.geometry.geometries[0].coordinates[1] }}
              </p>
            </div>
          </div>
        </div>

        <footer class="features-footer">
          <nav class="pager" data-ng-if="page.reports.properties.page === 1 && page.reports.properties.total_pages === 1">
            <!-- If your on Page 1 and there's less than or equal to 10 results total -->
            <span class="page">
              Showing all {{ page.reports.properties.num_results }} reports
            </span>
          </nav>
          <nav class="pager" data-ng-if="page.reports.properties.total_pages > 1">
            <a data-ng-show="page.reports.properties.total_pages >= page.reports.properties.page && page.reports.properties.page !== 1" href="javascript:void(0);" data-ng-click="activity.search.paginate(page.reports.properties.page-1)" class="previous">
              Previous
            </a>
            <span data-ng-show="!activity.paginationLabel" data-ng-click="activity.paginationLabel =! activity.paginationLabel" class="page">Page {{ page.reports.properties.page }} of {{ page.reports.properties.total_pages }}</span>
            <span data-ng-show="activity.paginationLabel" data-ng-click="activity.paginationLabel =! activity.paginationLabel" class="page">
              <span data-ng-if="page.reports.properties.page === 1 && page.reports.properties.total_pages > 1">
                Showing 1 - 10 of {{ page.reports.properties.num_results | number:0 }} reports
              </span>

              <span data-ng-if="page.reports.properties.page > 1 && page.reports.properties.page !== page.reports.properties.total_pages">
                Showing <span data-ng-bind="((page.reports.properties.page-1)*10+1)"></span> - <span data-ng-bind="page.reports.properties.page*10"></span> of {{ page.reports.properties.num_results | number:0 }} reports
              </span>

              <span data-ng-if="page.reports.properties.page > 1 && page.reports.properties.page === page.reports.properties.total_pages">
                Showing <span data-ng-bind="((page.reports.properties.page-1)*10+1)"></span> - {{ page.reports.properties.num_results }} of {{ page.reports.properties.num_results | number:0 }} reports
              </span>
            </span>
            <a data-ng-show="page.reports.properties.total_pages !== page.reports.properties.page" href="javascript:void(0);" data-ng-click="activity.search.paginate(page.reports.properties.page+1)" class="next">
              Next
            </a>
          </nav>
        </footer>
      </div>
    </div>
  </div>
</main>

<div data-ng-include="'/modules/shared/views/footer--view.html'"></div>
