<div data-ng-include="'/modules/shared/views/header--view.html'"></div>

<div class="map--wrapper">
  <leaflet data-ng-if="page.report" class="map" markers="page.map.markers" defaults="page.map.defaults" layers="page.map.layers" center="page.map.center" bounds="page.map.bounds"></leaflet>
</div>

<main class="site--content">

    <div class="throbber" data-ng-if="!page.report"></div>

    <div class="features" data-ng-if="page.report">
      <div class="container">
        <article id="report--{{ page.report.properties.id }}" class="report report--single">

          <div data-ng-include="'/modules/components/report/reportContent--view.html'"></div>

          <div class="report--comments">

            <div data-ng-include="'/modules/components/report/reportComments--view.html'"></div>

            <div data-ng-include="'/modules/components/report/reportCommentsForm--view.html'"></div>

          </div>

        </article>

        <aside class="report--metadata">
          <aside class="report--action" data-ng-if="page.report.properties.state === 'closed'">
            <img src="/images/badget--CertifiedAction--Color.svg" width="228" height="228" alt="" />

            <a class="report--action--owner" href="/profiles/{{ page.report.properties.closed_by.properties.id }}">
              <span>Action Taken By</span><br />
              {{ page.report.properties.closed_by.properties.first_name }} {{ page.report.properties.closed_by.properties.last_name }}
            </a>
          </aside>
          <header class="report--author">
            <div class="report--metadata--section">
              <button data-ng-if="page.permissions.isAdmin || page.permissions.isOwner" class="button button--submit" data-ng-click="page.edit(page.report.id)">Edit Report</button>
              <button data-ng-if="page.permissions.isAdmin || page.permissions.isOwner" class="button button--danger" data-ng-click="page.delete(page.report.id)">Delete Report</button>
            </div>
            <div class="report--metadata--section">
              <p>
                <a href="/profiles/{{ page.report.properties.owner.id }}">
                  <img class="report--author--avatar"
                       data-ng-src="{{ page.report.properties.owner.properties.picture }}"
                       width="32" />
                </a>
                <a class="report--author--name" href="/profiles/{{ page.report.properties.owner.id }}">
                  {{ page.report.properties.owner.properties.first_name }} {{ page.report.properties.owner.properties.last_name }}
                </a>
                <span class="report--date">
                  submitted this report
                  <span data-ng-if="page.report.timeToggle"
                        data-ng-click="page.report.timeToggle =! page.report.timeToggle"
                        am-time-ago="page.report.properties.report_date"></span>
                  <span data-ng-if="!page.report.timeToggle"
                        data-ng-click="page.report.timeToggle =! page.report.timeToggle">
                    on {{ page.report.properties.report_date | date:"MMM d, yyyy"}}
                  </span>
                </span>
              </p>
            </div>
            <div class="report--metadata--section">
              <p data-ng-if="page.report.properties.territory">
                <small><span class="glyphicon glyphicon-map-marker"></span> {{ page.report.properties.territory.properties.huc_6_name }} Watershed</small>
              </p>
            </div>
            <div class="report--metadata--section">
              <p>
                <span class="icon icon--directions retinaicon-transport-007"></span>
                <a href="https://www.google.com/maps/dir//{{ page.report.geometry.geometries[0].coordinates[1] }},{{ page.report.geometry.geometries[0].coordinates[0] }}" target="_blank">
                  <small>Get directions to this report location</small>
                </a>
              </p>
            </div>
            <div class="report--metadata--section">
              <a href="https://api.addthis.com/oexchange/0.8/forward/facebook/offer?url=http%3A%2F%2Fwww.waterreporter.org%2Freports%2F{{ page.report.id }}&pubid=ra-55b7d3663dc9a0fe&ct=1&title=Check%20out%20this%20report%20on%20WaterReporter&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/facebook.png" border="0" alt="Facebook"/></a>
              <a href="https://api.addthis.com/oexchange/0.8/forward/twitter/offer?url=http%3A%2F%2Fwww.waterreporter.org%2Freports%2F{{ page.report.id }}&pubid=ra-55b7d3663dc9a0fe&ct=1&title=Check%20out%20this%20report%20on%20WaterReporter&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/twitter.png" border="0" alt="Twitter"/></a>
              <a href="https://api.addthis.com/oexchange/0.8/forward/pinterest/offer?url=http%3A%2F%2Fwww.waterreporter.org%2Freports%2F{{ page.report.id }}&pubid=ra-55b7d3663dc9a0fe&ct=1&title=Check%20out%20this%20report%20on%20WaterReporter&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/pinterest.png" border="0" alt="Pinterest"/></a>
              <a href="https://api.addthis.com/oexchange/0.8/forward/linkedin/offer?url=http%3A%2F%2Fwww.waterreporter.org%2Freports%2F{{ page.report.id }}&pubid=ra-55b7d3663dc9a0fe&ct=1&title=Check%20out%20this%20report%20on%20WaterReporter&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/linkedin.png" border="0" alt="LinkedIn"/></a>
              <a href="https://api.addthis.com/oexchange/0.8/forward/email/offer?url=http%3A%2F%2Fwww.waterreporter.org%2Freports%2F{{ page.report.id }}&pubid=ra-55b7d3663dc9a0fe&ct=1&title=Check%20out%20this%20report%20on%20WaterReporter&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v2/thumbs/32x32/email.png" border="0" alt="Email"/></a>


              <!-- <div addthis-toolbox class="addthis_sharing_toolbox" data-url="http://www.waterreporter.org/reports/{{ page.report.id }}" data-title="Report in the {{ page.report.properties.territory.properties.huc_6_name }} watershed via WaterReporter">
                <div id="atstbx" class="at-share-tbx-element addthis_32x32_style addthis-smartlayers addthis-animated at4-show">
                  <a class="at-share-btn at-svc-facebook">
                    <span class="at4-icon aticon-facebook" title="Facebook"></span>
                  </a>
                  <a class="at-share-btn at-svc-twitter">
                    <span class="at4-icon aticon-twitter" title="Twitter"></span>
                  </a>
                  <a class="at-share-btn at-svc-linkedin">
                    <span class="at4-icon aticon-linkedin" title="LinkedIn"></span>
                  </a>
                  <a class="at-share-btn at-svc-pinterest_share">
                    <span class="at4-icon aticon-pinterest_share" title="Pinterest"></span>
                  </a>
                  <a class="at-share-btn at-svc-email">
                    <span class="at4-icon aticon-email" title="Email"></span>
                  </a>
                </div>
              </div> -->
            </div>
            <div class="report--metadata--section"
                 data-ng-if="page.other.reports.length">
              <p class="report--metadata--sectionTitle">
                <strong>
                Other Reports by {{ page.report.properties.owner.properties.first_name }} {{ page.report.properties.owner.properties.last_name }}</strong>
              </p>
              <a href="/reports/{{ report.id }}" class="report--media"
                    data-ng-repeat="report in page.other.reports track by $index">
                  <img data-ng-if="report.properties.images[0].properties.thumbnail"
                       data-ng-src="{{ report.properties.images[0].properties.thumbnail }}" width="196px" />
                  <img data-ng-if="!report.properties.images[0].properties.thumbnail"
                       data-ng-src="{{ report.properties.images[0].properties.original }}" width="196px" />
                  <img data-ng-if="!report.properties.images[0].properties.original"
                       data-ng-src="/images/icon--MissingImage.png" width="196px" />
              </a>
            </div>
          </header>

        </aside>

      </div>
    </div>
  </div>
</main>

<div data-ng-include="'/modules/shared/views/footer--view.html'"></div>
