<div data-ng-include="'/modules/shared/views/header--view.html'"></div>

<main class="site--content site--content--activity">
  <aside class="site--content--statistics">
    <ul data-ng-if="activity.search.data.properties.num_results !== undefined">
      <li>
        <a href="/activity/">{{ activity.search.data.properties.num_results | number:0 }} Reports</a>
      </li>
      <li>
        <a href='/activity/?q={"filters":[{"name":"state","op":"eq","val":"open"}]}'>--- Open</a>
      </li>
      <li>
        <a href='/activity/?q={"filters":[{"name":"state","op":"eq","val":"closed"}]}'>--- Closed</a>
      </li>
    </ul>
  </aside>

  <div class="container">

    <div class="row">
      <div class="col-sm-12">
        <button data-ng-if="report.data.properties.state !== 'closed'" class="btn btn-danger" data-ng-click="report.delete(report.data.id)">Delete Report</button>
        <a class="btn btn-info" href="mailto:example@waterreporter.org?subject=Check out this Report on www.waterreporter.org&body=I wanted to share this report from WaterReporter with you. http://www.waterreporter.org/reports/{{ report.data.id }}" target="_blank">Share Report</a>
      </div>
    </div>

    <div class="row">
      <div id="report--{{ report.data.properties.id }}" class="col-sm-12" data-ng-class="{'report--state--open': (report.data.properties.state === 'open'), 'report--state--closed': (report.data.properties.state === 'closed') }">
        <span data-ng-if="report.data.properties.state === 'open'" class="label label-danger">OPEN REPORT</span>
        <span data-ng-if="report.data.properties.state === 'closed'" class="label label-success">CLOSED REPORT</span>
        <div class="row">
          <div class="col-sm-12">
            <p class="pull-right">{{ report.data.properties.report_date | date:"MMM d, yyyy"}}</p>
            <a href="/profiles/{{ report.data.properties.owner.id }}">
              <img class="pull-left" data-ng-if="report.data.properties.owner.properties.email" gravatar-src="'{{ report.data.properties.owner.properties.email }}'" gravatar-size="64" />
            </a>
            <p class="pull-left">
              <a href="/profiles/{{ report.data.properties.owner.id }}">
                {{ report.data.properties.owner.properties.first_name }} {{ report.data.properties.owner.properties.last_name }}
              </a><br />
              {{ report.data.properties.owner.properties.title }} <span data-ng-if="report.data.properties.owner.properties.title && report.data.properties.owner.properties.organization_name">at</span><br data-ng-if="report.data.properties.owner.properties.title && report.data.properties.owner.properties.organization_name" />
              {{ report.data.properties.owner.properties.organization_name }}
            </p>
          </div>
        </div>

        <figure data-ng-if="report.data.properties.images && report.data.properties.images.length">
<!--           <img photoio photoio-u="image.properties.original" photoio-w="640" photoio-h="640" photoio-mode="crop" data-ng-repeat="image in report.data.properties.images" /> -->
          <img class="img-responsive" data-ng-src="{{ image.properties.original }}" width="640" data-ng-repeat="image in report.data.properties.images" />
        </figure>

        <p>{{ report.data.properties.report_description }}</p>

        <ul data-ng-if="report.data.properties.tags.length">
          <li data-ng-repeat="tag in report.data.properties.tags">
            <a href="" data-ng-click="activity.search.hashtag(tag.properties.tag, 'report_description')">
              #{{ tag.properties.tag }}
            </a>
          </li>
        </ul>

        <p>
          {{ report.data.geometry.geometries[0].coordinates[0] }}<br />
          {{ report.data.geometry.geometries[0].coordinates[1] }}
        </p>
      </div>
      <hr />
    </div>

    <div class="row" data-ng-if="!report.data.properties.comments.length">
      <div class="col-sm-12">
        No response from water keeper
      </div>
    </div>

    <div id="report--comment--{{ $index }}" class="row" data-ng-if="report.data.properties.comments.length" data-ng-repeat="comment in report.comments.features track by $index">
      <div class="col-sm-4 text-center">
        <img data-ng-if="comment.properties.owner.properties.email" gravatar-src="'{{ comment.properties.owner.properties.email }}'" gravatar-size="64" />
        <p>
          {{ comment.properties.owner.properties.first_name }} {{ comment.properties.owner.properties.last_name }}
        </p>
        <p>{{ comment.properties.created | date:"MMM d, yyyy"}}</p>
      </div>
      <div class="col-sm-8">
        {{ comment.properties.body }}
      </div>
    </div>

    <form class="site--report--comment form" role="form" id="form--reports--comment" name="form--reports--comment" data-ng-submit="report.comment.save(report.data.id)">
      <div class="form-group">
        <label for="report--commentBody">Comment</label>
        <textarea id="report--commentBody" name="report--commentBody" class="form-control" data-ng-model="report.comment.data.body"></textarea>
      </div>
      <button data-ng-if="report.data.properties.state !== 'closed'" class="btn btn-default" data-ng-click="report.comment.close(report.data.id)">
        Close Report
      </button>
      <button data-ng-if="report.data.properties.state === 'closed'" class="btn btn-default" data-ng-click="report.comment.open(report.data.id)">
        Reopen Report
      </button>
      <button id="report--comment--submit" name="report--comment--submit" class="btn btn-success">
        Comment
      </button>
    </form>

  </div>
</main>

<div data-ng-include="'/modules/shared/views/footer--view.html'"></div>
