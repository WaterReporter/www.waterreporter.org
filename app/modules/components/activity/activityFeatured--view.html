<leaflet class="map" geojson="page.map.geojson" geojson-nested="true" defaults="page.map.defaults" layers="page.map.layers" center="page.map.center" bounds="page.map.bounds"></leaflet>

<h2>Features</h2>

<div class="features">

  <div class="features--single" data-ng-show="page.features.visible === $index" data-ng-repeat="report in page.map.geojson.reports.data.features track by $index">
    <a data-ng-if="$index" data-ng-click="page.changeFeature(page.map.geojson.reports.data.features[$index-1], $index-1)">< ({{ $index-1 }})</a>
    <a data-ng-if="!$last" data-ng-click="page.changeFeature(page.map.geojson.reports.data.features[$index+1], $index+1)">({{ $index+1 }}) ></a>
    <div id="report--{{ report.properties.id }}" class="panel panel-default" data-ng-class="{'report--state--closed': (report.properties.state === 'closed') }">
      <div class="panel-heading">
        <p class="pull-right">{{ report.properties.report_date | date:"MMM d, yyyy"}}</p>
        <a href="/profiles/{{ report.properties.owner.id }}">
          <img class="pull-left img-circle" data-ng-if="report.properties.owner.properties.email" gravatar-src="'{{ report.properties.owner.properties.email }}'" gravatar-size="64" style="padding-right: 12px;" />
        </a>
        <p>
          <a href="/profiles/{{ report.properties.owner.id }}">
            {{ report.properties.owner.properties.first_name }} {{ report.properties.owner.properties.last_name }}
          </a><br />
          {{ report.properties.owner.properties.title }} <span data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name">at</span><br data-ng-if="report.properties.owner.properties.title && report.properties.owner.properties.organization_name" />
          {{ report.properties.owner.properties.organization_name }}
        </p>
      </div>
      <figure data-ng-if="report.properties.images && report.properties.images.length">
        <a href="/reports/{{ report.id }}">
          <img class="img-responsive" data-ng-src="{{ image.properties.original }}" data-ng-repeat="image in report.properties.images" width="100%" />
        </a>
      </figure>
      <div class="panel-body">

        <p>
          <strong>User Submitted Content:</strong>
          {{ report.properties.report_description }}</p>
        <p>
          <strong>Permalink: </strong> <a href="/reports/{{ report.id }}">
            View report
          </a>
        </p>
        <p>
          <strong>Comments: </strong>  {{ report.properties.comments.length }}
        </p>
        <p>
          <strong>Watersheds: </strong>
          <span data-ng-if="report.properties.territory">
            {{ report.properties.territory.properties.huc_6_name }}, {{ report.properties.territory.properties.huc_8_name }}, {{ report.properties.territory.properties.huc_10_name }}, {{ report.properties.territory.properties.huc_12_name }}
          </span>
          <span data-ng-if="!report.properties.territory">
            <em>None</em>
          </span>
        </p>
        <p>
          <strong>Tags: </strong>
          <span data-ng-if="report.properties.tags.length">
            <span class="label label--brand" data-ng-repeat="tag in report.properties.tags">
              <a href="" data-ng-click="page.search.hashtag(tag.properties.tag, 'report_description')">
                #{{ tag.properties.tag }}
              </a>
            </span>
          </span>
          <span data-ng-if="!report.properties.tags.length">
            <em>None</em>
          </span>
        </p>

        <p>
          <strong>Longitude/Latitude: </strong> <em>
            <span data-ng-if="report.geometry">
              {{ report.geometry.geometries[0].coordinates[0] }},
              {{ report.geometry.geometries[0].coordinates[1] }}
            </span>
            <span data-ng-if="!report.geometry">
              None
            </span>
          </em>
        </p>
      </div>
    </div>
  </div>
</div>
